!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e){t.exports=require("mongoose")},function(t,e){t.exports=require("express-promise-router")},function(t,e,n){const i=n(16),o=n(3),{JWT_SECRET:r}=process.env,a={signup:i.object().keys({email:i.string().email().required(),password:i.string().required(),username:i.string().alphanum().min(3).max(16).required()}),signin:i.object().keys({email:i.string().email().required(),password:i.string().required()}),passwordRecovery:i.object().keys({email:i.string().email().required()}),changePassword:i.object().keys({currentPassword:i.string().required(),newPassword:i.string().required()}),setNewPassword:i.object().keys({username:i.string().alphanum().min(3).max(16).required(),code:i.string().required(),newPassword:i.string().required()}),createList:i.object().keys({_id:i.string(),name:i.string().min(1).max(24).required(),html:i.string().required(),backgroundColor:i.string().required(),updatedAt:i.date().required(),isPrivate:i.bool().required(),notificationsOn:i.bool().required(),isFinished:i.bool(),copiedFrom:i.string().allow("")}),updateList:i.object().keys({name:i.string().min(1).max(24).required(),html:i.string().required(),backgroundColor:i.string().required(),notificationsOn:i.bool().required(),isPrivate:i.bool().required(),updatedAt:i.date().required(),isFinished:i.bool(),copiedFrom:i.string().allow("")})};t.exports={schemas:a,validateBody:t=>(e,n,o)=>{const r=i.validate(e.body,t);if(r.error)return n.status(400).json(r.error);o()},tokenAuth:()=>(t,e,n)=>{const i=t.header("x-auth-token");if(!i)return e.status(401).json({error:"No token, authorization denied"});try{const a=o.verify(i,r);t.user=a.subject,n()}catch(t){e.status(400).json({error:"Token is not valid"})}},userAuth:()=>async(t,e,n)=>{const{username:i}=t.body,o=await User.findOne({username:i});return o?await o.isValidPwRecoveryCode(code)?void e.status(200).json({msg:"Set a new password now.",_id:o._id}):e.status(401).json({error:"The verification code does not match."}):e.status(404).json({error:"There is no account associated with this username."})}}},function(t,e){t.exports=require("jsonwebtoken")},function(t,e,n){const i=n(0),o=n(5),{generateNonce:r}=n(6),a=new(0,i.Schema)({email:{type:String,required:!0,unique:!0,lowercase:!0},password:{type:String,required:!0},username:{type:String,required:!0,unique:!0},createdAt:{type:Date,default:Date.now()},isVerified:{type:Boolean,default:!1},verificationCode:{value:{type:String,default:r(16)},createdAt:{type:Date,default:Date.now()}},activationHash:String,pwRecoveryCode:{value:String,createdAt:Date},pwRecoveryHash:String});a.pre("save",async function(){try{if(this.isNew){const t=await o.genSalt(10),e=await o.genSalt(10),n=await o.hash(this.password,t),i=await o.hash(this.verificationCode.value,e);this.password=n,this.activationHash=i}}catch(t){console.log(t)}}),a.methods.isValidPassword=async function(t){try{return await o.compare(t,this.password)}catch(t){console.log(t)}},a.methods.isVerifiedEmail=async function(t){try{return await o.compare(t,this.activationHash)}catch(t){console.log(t)}},a.methods.isValidPwRecoveryCode=async function(t){try{if(Date.now()-this.pwRecoveryCode.createdAt>18e5)throw new Error("Code has expired");return await o.compare(t,this.pwRecoveryHash)}catch(t){console.log(t)}};const s=i.model("user",a);t.exports=s},function(t,e){t.exports=require("bcryptjs")},function(t,e,n){const i=n(18);t.exports={generateNonce:t=>i.randomBytes(t).toString("hex")}},function(t,e,n){const i=n(19),o=n(5),r=n(3),a=n(20),{JWT_SECRET:s,SMTP_HOST:d,SMTP_PORT:l,SMTP_AUTH_USER:c,SMTP_AUTH_PASS:p,MAIL_FROM:u,SERVER_URL:h}=process.env,m=async t=>{try{const e=await o.genSalt(10);return await o.hash(t,e)}catch(t){console.log(t)}};t.exports={sendEmailVerification:async(t,e,n)=>{try{const o=i.createTransport({host:d,port:l,secure:!0,auth:{user:c,pass:p}}),r=`${h}/api/users/email-verification/${e}/${n}`,a={from:u,to:t,subject:"Verify your account",text:`Your account has been created. Please visit ${r} to verify your email.`,html:`\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml">\n<head>\n\x3c!--[if gte mso 9]><xml><o:OfficeDocumentSettings><o:AllowPNG/><o:PixelsPerInch>96</o:PixelsPerInch></o:OfficeDocumentSettings></xml><![endif]--\x3e\n<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>\n<meta content="width=device-width" name="viewport"/>\n\x3c!--[if !mso]>\x3c!--\x3e\n<meta content="IE=edge" http-equiv="X-UA-Compatible"/>\n\x3c!--<![endif]--\x3e\n<title>Email verification - EasyList.link</title>\n\x3c!--[if !mso]>\x3c!--\x3e\n<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css"/>\n\x3c!--<![endif]--\x3e\n<style type="text/css">\n\t\tbody {\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\n\t\ttable,\n\t\ttd,\n\t\ttr {\n\t\t\tvertical-align: top;\n\t\t\tborder-collapse: collapse;\n\t\t}\n\n\t\t* {\n\t\t\tline-height: inherit;\n\t\t}\n\n\t\ta[x-apple-data-detectors=true] {\n\t\t\tcolor: inherit !important;\n\t\t\ttext-decoration: none !important;\n\t\t}\n\t</style>\n<style id="media-query" type="text/css">\n\t\t@media (max-width: 520px) {\n\n\t\t\t.block-grid,\n\t\t\t.col {\n\t\t\t\tmin-width: 320px !important;\n\t\t\t\tmax-width: 100% !important;\n\t\t\t\tdisplay: block !important;\n\t\t\t}\n\n\t\t\t.block-grid {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col>div {\n\t\t\t\tmargin: 0 auto;\n\t\t\t}\n\n\t\t\timg.fullwidth,\n\t\t\timg.fullwidthOnMobile {\n\t\t\t\tmax-width: 100% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col {\n\t\t\t\tmin-width: 0 !important;\n\t\t\t\tdisplay: table-cell !important;\n\t\t\t}\n\n\t\t\t.no-stack.two-up .col {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num8 {\n\t\t\t\twidth: 66% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num3 {\n\t\t\t\twidth: 25% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num6 {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num9 {\n\t\t\t\twidth: 75% !important;\n\t\t\t}\n\n\t\t\t.video-block {\n\t\t\t\tmax-width: none !important;\n\t\t\t}\n\n\t\t\t.mobile_hide {\n\t\t\t\tmin-height: 0px;\n\t\t\t\tmax-height: 0px;\n\t\t\t\tmax-width: 0px;\n\t\t\t\tdisplay: none;\n\t\t\t\toverflow: hidden;\n\t\t\t\tfont-size: 0px;\n\t\t\t}\n\n\t\t\t.desktop_hide {\n\t\t\t\tdisplay: block !important;\n\t\t\t\tmax-height: none !important;\n\t\t\t}\n\t\t}\n\t</style>\n</head>\n<body class="clean-body" style="margin: 0; padding: 0; -webkit-text-size-adjust: 100%; background-color: transparent;">\n\x3c!--[if IE]><div class="ie-browser"><![endif]--\x3e\n<table bgcolor="transparent" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="table-layout: fixed; vertical-align: top; min-width: 320px; Margin: 0 auto; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: transparent; width: 100%;" valign="top" width="100%">\n<tbody>\n<tr style="vertical-align: top;" valign="top">\n<td style="word-break: break-word; vertical-align: top;" valign="top">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color:transparent"><![endif]--\x3e\n<div style="background-color:transparent;">\n<div class="block-grid" style="Margin: 0 auto; min-width: 320px; max-width: 500px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; background-color: transparent;">\n<div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:500px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]><td align="center" width="500" style="background-color:transparent;width:500px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#F8E9FC;"><![endif]--\x3e\n<div class="col num12" style="min-width: 320px; max-width: 500px; display: table-cell; vertical-align: top; width: 500px;">\n<div style="background-color:#F8E9FC;width:100% !important;">\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n<div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;">\n\x3c!--<![endif]--\x3e\n<div align="center" class="img-container center autowidth fullwidth" style="padding-right: 60px;padding-left: 60px;">\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr style="line-height:0px"><td style="padding-right: 60px;padding-left: 60px;" align="center"><![endif]--\x3e\n<div style="font-size:1px;line-height:60px"> </div><img align="center" alt="Image" border="0" class="center autowidth fullwidth" src="https://github.com/chadpjontek/resources/raw/master/images/easylist-logo.png" style="text-decoration: none; -ms-interpolation-mode: bicubic; border: 0; height: auto; width: 100%; max-width: 380px; display: block;" title="Image" width="380"/>\n<div style="font-size:1px;line-height:60px"> </div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n</div>\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 60px; padding-left: 60px; padding-top: 60px; padding-bottom: 60px; font-family: Arial, sans-serif"><![endif]--\x3e\n<div style="color:#000;font-family:'Open Sans', Helvetica, Arial, sans-serif;line-height:1.2;padding-top:60px;padding-right:60px;padding-bottom:60px;padding-left:60px;">\n<div style="font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 12px; line-height: 1.2; color: #000; mso-line-height-alt: 14px;">\n<p style="font-size: 14px; line-height: 1.2; text-align: center; mso-line-height-alt: 17px; margin: 0;"><span style="font-size: 18px;">Hi <strong>${e}</strong>! Your account has been created. Please <strong><a href="${r}">CLICK HERE</a></strong> to verify your email.</span></p>\n</div>\n</div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n</div>\n\x3c!--<![endif]--\x3e\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--\x3e\n</div>\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n</td>\n</tr>\n</tbody>\n</table>\n\x3c!--[if (IE)]></div><![endif]--\x3e\n</body>\n</html>`};let s=await o.sendMail(a);console.log("Message sent: %s",s.messageId)}catch(t){console.log(t)}},sendPasswordRecoveryEmail:async(t,e,n)=>{try{const o=i.createTransport({host:d,port:l,secure:!0,auth:{user:c,pass:p}}),r=`${h}/api/users/password-recovery/${e}/${n}`,a={from:u,to:t,subject:"Reset your password",text:`You can reset your password now. Please visit ${r} to be taken to the new password creation screen.`,html:`\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml">\n<head>\n\x3c!--[if gte mso 9]><xml><o:OfficeDocumentSettings><o:AllowPNG/><o:PixelsPerInch>96</o:PixelsPerInch></o:OfficeDocumentSettings></xml><![endif]--\x3e\n<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>\n<meta content="width=device-width" name="viewport"/>\n\x3c!--[if !mso]>\x3c!--\x3e\n<meta content="IE=edge" http-equiv="X-UA-Compatible"/>\n\x3c!--<![endif]--\x3e\n<title>Password Reset - EasyList.link</title>\n\x3c!--[if !mso]>\x3c!--\x3e\n<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css"/>\n\x3c!--<![endif]--\x3e\n<style type="text/css">\n\t\tbody {\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\n\t\ttable,\n\t\ttd,\n\t\ttr {\n\t\t\tvertical-align: top;\n\t\t\tborder-collapse: collapse;\n\t\t}\n\n\t\t* {\n\t\t\tline-height: inherit;\n\t\t}\n\n\t\ta[x-apple-data-detectors=true] {\n\t\t\tcolor: inherit !important;\n\t\t\ttext-decoration: none !important;\n\t\t}\n\t</style>\n<style id="media-query" type="text/css">\n\t\t@media (max-width: 520px) {\n\n\t\t\t.block-grid,\n\t\t\t.col {\n\t\t\t\tmin-width: 320px !important;\n\t\t\t\tmax-width: 100% !important;\n\t\t\t\tdisplay: block !important;\n\t\t\t}\n\n\t\t\t.block-grid {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col>div {\n\t\t\t\tmargin: 0 auto;\n\t\t\t}\n\n\t\t\timg.fullwidth,\n\t\t\timg.fullwidthOnMobile {\n\t\t\t\tmax-width: 100% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col {\n\t\t\t\tmin-width: 0 !important;\n\t\t\t\tdisplay: table-cell !important;\n\t\t\t}\n\n\t\t\t.no-stack.two-up .col {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num8 {\n\t\t\t\twidth: 66% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num3 {\n\t\t\t\twidth: 25% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num6 {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num9 {\n\t\t\t\twidth: 75% !important;\n\t\t\t}\n\n\t\t\t.video-block {\n\t\t\t\tmax-width: none !important;\n\t\t\t}\n\n\t\t\t.mobile_hide {\n\t\t\t\tmin-height: 0px;\n\t\t\t\tmax-height: 0px;\n\t\t\t\tmax-width: 0px;\n\t\t\t\tdisplay: none;\n\t\t\t\toverflow: hidden;\n\t\t\t\tfont-size: 0px;\n\t\t\t}\n\n\t\t\t.desktop_hide {\n\t\t\t\tdisplay: block !important;\n\t\t\t\tmax-height: none !important;\n\t\t\t}\n\t\t}\n\t</style>\n</head>\n<body class="clean-body" style="margin: 0; padding: 0; -webkit-text-size-adjust: 100%; background-color: transparent;">\n\x3c!--[if IE]><div class="ie-browser"><![endif]--\x3e\n<table bgcolor="transparent" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="table-layout: fixed; vertical-align: top; min-width: 320px; Margin: 0 auto; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: transparent; width: 100%;" valign="top" width="100%">\n<tbody>\n<tr style="vertical-align: top;" valign="top">\n<td style="word-break: break-word; vertical-align: top;" valign="top">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color:transparent"><![endif]--\x3e\n<div style="background-color:transparent;">\n<div class="block-grid" style="Margin: 0 auto; min-width: 320px; max-width: 500px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; background-color: transparent;">\n<div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:500px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]><td align="center" width="500" style="background-color:transparent;width:500px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#F8E9FC;"><![endif]--\x3e\n<div class="col num12" style="min-width: 320px; max-width: 500px; display: table-cell; vertical-align: top; width: 500px;">\n<div style="background-color:#F8E9FC;width:100% !important;">\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n<div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;">\n\x3c!--<![endif]--\x3e\n<div align="center" class="img-container center autowidth fullwidth" style="padding-right: 60px;padding-left: 60px;">\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr style="line-height:0px"><td style="padding-right: 60px;padding-left: 60px;" align="center"><![endif]--\x3e\n<div style="font-size:1px;line-height:60px"> </div><img align="center" alt="Image" border="0" class="center autowidth fullwidth" src="https://github.com/chadpjontek/resources/raw/master/images/easylist-logo.png" style="text-decoration: none; -ms-interpolation-mode: bicubic; border: 0; height: auto; width: 100%; max-width: 380px; display: block;" title="Image" width="380"/>\n<div style="font-size:1px;line-height:60px"> </div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n</div>\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 60px; padding-left: 60px; padding-top: 60px; padding-bottom: 60px; font-family: Arial, sans-serif"><![endif]--\x3e\n<div style="color:#000;font-family:'Open Sans', Helvetica, Arial, sans-serif;line-height:1.2;padding-top:60px;padding-right:60px;padding-bottom:60px;padding-left:60px;">\n<div style="font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 12px; line-height: 1.2; color: #000; mso-line-height-alt: 14px;">\n<p style="font-size: 14px; line-height: 1.2; text-align: center; mso-line-height-alt: 17px; margin: 0;"><span style="font-size: 18px;">Hi <strong>${e}</strong>! You can reset your password now. Please <strong><a href="${r}">CLICK HERE</a></strong> to be taken to the new password creation screen.</span></p>\n</div>\n</div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n</div>\n\x3c!--<![endif]--\x3e\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--\x3e\n</div>\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n</td>\n</tr>\n</tbody>\n</table>\n\x3c!--[if (IE)]></div><![endif]--\x3e\n</body>\n</html>`};let s=await o.sendMail(a);console.log("Message sent: %s",s.messageId)}catch(t){console.log(t)}},sendListCompletionNotification:async(t,e,n,o)=>{try{const r=i.createTransport({host:d,port:l,secure:!0,auth:{user:c,pass:p}}),a={from:u,to:e,subject:`${t} has been completed by ${o}!`,text:`Your list, ${t}, has just been completed by ${o}!`,html:`\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml">\n<head>\n\x3c!--[if gte mso 9]><xml><o:OfficeDocumentSettings><o:AllowPNG/><o:PixelsPerInch>96</o:PixelsPerInch></o:OfficeDocumentSettings></xml><![endif]--\x3e\n<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>\n<meta content="width=device-width" name="viewport"/>\n\x3c!--[if !mso]>\x3c!--\x3e\n<meta content="IE=edge" http-equiv="X-UA-Compatible"/>\n\x3c!--<![endif]--\x3e\n<title>${t} has been completed by ${o}!</title>\n\x3c!--[if !mso]>\x3c!--\x3e\n<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css"/>\n\x3c!--<![endif]--\x3e\n<style type="text/css">\n\t\tbody {\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\n\t\ttable,\n\t\ttd,\n\t\ttr {\n\t\t\tvertical-align: top;\n\t\t\tborder-collapse: collapse;\n\t\t}\n\n\t\t* {\n\t\t\tline-height: inherit;\n\t\t}\n\n\t\ta[x-apple-data-detectors=true] {\n\t\t\tcolor: inherit !important;\n\t\t\ttext-decoration: none !important;\n\t\t}\n\t</style>\n<style id="media-query" type="text/css">\n\t\t@media (max-width: 520px) {\n\n\t\t\t.block-grid,\n\t\t\t.col {\n\t\t\t\tmin-width: 320px !important;\n\t\t\t\tmax-width: 100% !important;\n\t\t\t\tdisplay: block !important;\n\t\t\t}\n\n\t\t\t.block-grid {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col {\n\t\t\t\twidth: 100% !important;\n\t\t\t}\n\n\t\t\t.col>div {\n\t\t\t\tmargin: 0 auto;\n\t\t\t}\n\n\t\t\timg.fullwidth,\n\t\t\timg.fullwidthOnMobile {\n\t\t\t\tmax-width: 100% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col {\n\t\t\t\tmin-width: 0 !important;\n\t\t\t\tdisplay: table-cell !important;\n\t\t\t}\n\n\t\t\t.no-stack.two-up .col {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num8 {\n\t\t\t\twidth: 66% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num4 {\n\t\t\t\twidth: 33% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num3 {\n\t\t\t\twidth: 25% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num6 {\n\t\t\t\twidth: 50% !important;\n\t\t\t}\n\n\t\t\t.no-stack .col.num9 {\n\t\t\t\twidth: 75% !important;\n\t\t\t}\n\n\t\t\t.video-block {\n\t\t\t\tmax-width: none !important;\n\t\t\t}\n\n\t\t\t.mobile_hide {\n\t\t\t\tmin-height: 0px;\n\t\t\t\tmax-height: 0px;\n\t\t\t\tmax-width: 0px;\n\t\t\t\tdisplay: none;\n\t\t\t\toverflow: hidden;\n\t\t\t\tfont-size: 0px;\n\t\t\t}\n\n\t\t\t.desktop_hide {\n\t\t\t\tdisplay: block !important;\n\t\t\t\tmax-height: none !important;\n\t\t\t}\n\t\t}\n\t</style>\n</head>\n<body class="clean-body" style="margin: 0; padding: 0; -webkit-text-size-adjust: 100%; background-color: transparent;">\n\x3c!--[if IE]><div class="ie-browser"><![endif]--\x3e\n<table bgcolor="transparent" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="table-layout: fixed; vertical-align: top; min-width: 320px; Margin: 0 auto; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: transparent; width: 100%;" valign="top" width="100%">\n<tbody>\n<tr style="vertical-align: top;" valign="top">\n<td style="word-break: break-word; vertical-align: top;" valign="top">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color:transparent"><![endif]--\x3e\n<div style="background-color:transparent;">\n<div class="block-grid" style="Margin: 0 auto; min-width: 320px; max-width: 500px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; background-color: transparent;">\n<div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;">\n\x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:500px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]><td align="center" width="500" style="background-color:transparent;width:500px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#F8E9FC;"><![endif]--\x3e\n<div class="col num12" style="min-width: 320px; max-width: 500px; display: table-cell; vertical-align: top; width: 500px;">\n<div style="background-color:#F8E9FC;width:100% !important;">\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n<div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;">\n\x3c!--<![endif]--\x3e\n<div align="center" class="img-container center autowidth fullwidth" style="padding-right: 60px;padding-left: 60px;">\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr style="line-height:0px"><td style="padding-right: 60px;padding-left: 60px;" align="center"><![endif]--\x3e\n<div style="font-size:1px;line-height:60px"> </div><img align="center" alt="Image" border="0" class="center autowidth fullwidth" src="https://github.com/chadpjontek/resources/raw/master/images/easylist-logo.png" style="text-decoration: none; -ms-interpolation-mode: bicubic; border: 0; height: auto; width: 100%; max-width: 380px; display: block;" title="Image" width="380"/>\n<div style="font-size:1px;line-height:60px"> </div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n</div>\n\x3c!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 60px; padding-left: 60px; padding-top: 60px; padding-bottom: 60px; font-family: Arial, sans-serif"><![endif]--\x3e\n<div style="color:#000;font-family:'Open Sans', Helvetica, Arial, sans-serif;line-height:1.2;padding-top:60px;padding-right:60px;padding-bottom:60px;padding-left:60px;">\n<div style="font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 12px; line-height: 1.2; color: #000; mso-line-height-alt: 14px;">\n<p style="font-size: 14px; line-height: 1.2; text-align: center; mso-line-height-alt: 17px; margin: 0;"><span style="font-size: 18px;">Hi <strong>${n}</strong>! Your list, <strong>${t}</strong>, has just been completed by <strong>${o}</strong>!</span></p>\n</div>\n</div>\n\x3c!--[if mso]></td></tr></table><![endif]--\x3e\n\x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e\n</div>\n\x3c!--<![endif]--\x3e\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n\x3c!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--\x3e\n</div>\n</div>\n</div>\n\x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n</td>\n</tr>\n</tbody>\n</table>\n\x3c!--[if (IE)]></div><![endif]--\x3e\n</body>\n</html>`};let s=await r.sendMail(a);console.log("Message sent: %s",s.messageId)}catch(t){console.log(t)}},signToken:t=>r.sign({issuer:"issuer",subject:t.id},s,{expiresIn:"1d"}),createHash:m,updatePassword:async(t,e)=>{try{t.password=await m(e),await t.save()}catch(t){console.log(t)}},cleanHTML:t=>{return a(t,{allowedTags:["b","i","ol","ul","li","a","br"],allowedAttributes:{a:["href"]}})}}},function(t,e,n){const i=n(9),o=n(10),r=n(0),a=n(11),s=n(12),d=n(13);n(14).config();const{DB_URI:l}=process.env,c=i();let p;const u={origin:p="https://easylist.link",optionsSuccessStatus:200};c.use(s(u)),c.set("trust proxy",1);const h=d({windowMs:9e5,max:100});c.use(h),r.connect(l,{useNewUrlParser:!0,useCreateIndex:!0}),c.use(a()),c.use(o("dev")),c.use(i.json()),c.use("/api/users",n(15)),c.use("/api/lists",n(21)),c.listen(process.env.PORT),console.log(`Server listening at ${process.env.PORT}`)},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("morgan")},function(t,e){t.exports=require("helmet")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("express-rate-limit")},function(t,e){t.exports=require("dotenv")},function(t,e,n){const i=n(1)(),{validateBody:o,schemas:r,tokenAuth:a}=n(2),s=n(17);i.route("/email-verification/:username/:code").get(s.verify),i.route("/password-recovery/:username/:code").get(s.validatePwRecovery),i.route("/").post(o(r.signup),s.signUp),i.route("/signin").post(o(r.signin),s.signIn),i.route("/password-recovery").post(o(r.passwordRecovery),s.passwordRecovery),i.route("/set-new-password").post(o(r.setNewPassword),s.setNewPassword),i.route("/account").get(a(),s.account),i.route("/change-password").post(o(r.changePassword),a(),s.changePassword),t.exports=i},function(t,e){t.exports=require("joi")},function(t,e,n){const i=n(4),{sendEmailVerification:o,sendPasswordRecoveryEmail:r,createHash:a,updatePassword:s,signToken:d}=n(7),{generateNonce:l}=n(6);t.exports={signUp:async(t,e)=>{try{const{email:n,password:r,username:a}=t.body;if(await i.findOne({email:n}))return e.status(403).json({error:"Email is already in use"});if(await i.findOne({username:a}))return e.status(403).json({error:"Username is already taken"});const s=new i({email:n,password:r,username:a});await s.save(),o(n,a,s.verificationCode.value),e.status(200).json({msg:"Sign up successful! Check your email to verify and finalize your account. You may need to check your spam folder if you don't see it."})}catch(t){throw new Error(t)}},verify:async(t,e)=>{try{const{username:n,code:r}=t.params,s=await i.findOne({username:n});if(!s){const t=encodeURIComponent("There is no account associated with this username.");return e.redirect("http://localhost:8080/signin/?msg="+t)}if(s.isVerified){const t=encodeURIComponent("This account has already been verified. You can log in now.");return e.redirect("http://localhost:8080/signin/?msg="+t)}if(!await s.isVerifiedEmail(r)){const t=encodeURIComponent("The verification code does not match.");return e.redirect("http://localhost:8080/signin/?msg="+t)}if(Date.now()-s.verificationCode.createdAt>108e5){const t=l(16);s.verificationCode.value=t,s.activationHash=await a(t),await s.save(),await o(s.email,n,s.verificationCode.value);const i=encodeURIComponent("The verification code has expired. A new code has been sent to your email.");return e.redirect("http://localhost:8080/signin/?msg="+i)}s.isVerified=!0,s.verificationCode={value:null,createdAt:null},s.activationHash=null,await s.save();const d=encodeURIComponent("Your account has been verified! You can now sign in.");e.redirect("http://localhost:8080/signin/?msg="+d)}catch(t){throw new Error(t)}},signIn:async(t,e)=>{try{const{email:n,password:r}=t.body,a=await i.findOne({email:n});if(!a)return e.status(404).json({error:"There is no account associated with this email."});if(!await a.isValidPassword(r))return e.status(401).json({error:"Incorrect password."});if(!a.isVerified)return await o(n,a.username,a.verificationCode.value),e.status(401).json({error:"You must verify your account before logging in. Check your email and click the link provided to continue."});const s=d(a);e.status(200).json({token:s})}catch(t){throw new Error(t)}},passwordRecovery:async(t,e)=>{try{const{email:n}=t.body,o=await i.findOne({email:n});if(!o)return e.status(404).json({error:"There is no account associated with this email."});const s=l(16);o.pwRecoveryCode.value=s,o.pwRecoveryCode.createdAt=Date.now(),o.pwRecoveryHash=await a(s),await o.save(),await r(n,o.username,o.pwRecoveryCode.value),e.status(200).json({msg:"An email has been sent to the address you provided with instructions to reset your password."})}catch(t){throw new Error(t)}},validatePwRecovery:async(t,e)=>{try{const{username:n,code:o}=t.params,r=await i.findOne({username:n});if(!r)return e.status(404).json({error:"There is no account associated with this username."});if(!await r.isValidPwRecoveryCode(o))return e.status(401).json({error:"The recovery code does not match."});e.status(200).json({msg:"You can now create a new password",username:n,code:o})}catch(t){throw new Error(t)}},changePassword:async(t,e)=>{try{const n=t.user,{currentPassword:o,newPassword:r}=t.body,a=await i.findOne({_id:n});return a?await a.isValidPassword(o)?(await s(a,r),e.status(200).json({msg:"New password set"})):e.status(401).json({error:"Incorrect password."}):e.status(404).json({error:"There is no account associated with this id."})}catch(t){throw new Error(t)}},setNewPassword:async(t,e)=>{try{const{username:n,code:o,newPassword:r}=t.body,a=await i.findOne({username:n});if(!a)return e.status(404).json({error:"There is no account associated with this username."});if(!await a.isValidPwRecoveryCode(o))return e.status(401).json({error:"The recovery code does not match."});await s(a,r),a.pwRecoveryCode={value:null,createdAt:null},a.pwRecoveryHash=null,await a.save(),e.status(200).json({msg:"Your new password has been set."})}catch(t){throw new Error(t)}},account:async(t,e)=>{try{const n=await i.findOne({_id:t.user});if(!n)return e.status(404).json({error:"There is no account associated with this id."});e.status(200).json({foundUser:n})}catch(t){throw new Error(t)}}}},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("nodemailer")},function(t,e){t.exports=require("sanitize-html")},function(t,e,n){const i=n(1)(),{validateBody:o,schemas:r,tokenAuth:a,userAuth:s}=n(2),d=n(22);i.route("/:id/copy").get(d.getCopy),i.route("/").get(a(),d.getLists),i.route("/:id").get(a(),d.getList),i.route("/:id/edit").get(a(),d.editList),i.route("/").post(a(),o(r.createList),d.createList),i.route("/:id").put(a(),o(r.updateList),d.updateList),i.route("/:id/share").put(a(),d.shareList),i.route("/:id/complete").put(a(),d.completeList),i.route("/:id").delete(a(),d.deleteList),t.exports=i},function(t,e,n){const i=n(23),o=n(4),{cleanHTML:r,sendListCompletionNotification:a}=n(7),{NODE_ENV:s}=process.env;t.exports={getLists:async(t,e)=>{const{user:n}=t;try{const t=await i.find({authorId:n});if(!t)return e.status(404).json({error:"No lists found for this user."});e.status(200).json({lists:t})}catch(t){throw new Error(t)}},getList:async(t,e)=>{const{user:n}=t;try{const{id:o}=t.params,r=await i.findById(o).where("authorId").equals(n);if(!r)return e.status(401).json({error:"Your request did not return a list."});e.status(200).json({list:r})}catch(t){throw new Error(t)}},shareList:async(t,e)=>{try{const{id:n}=t.params,{user:o}=t,r=await i.findById(n);if(r.authorId.toString()!==o)return e.status(401).json({error:"This list cannot be edited by this user."});r.isPrivate=!r.isPrivate,await r.save();const a=r.isPrivate?"Your list is now private.":"A link to your list has been copied to your clipboard. Share it with whomever you like!";let d;d="development"===s?`http://localhost:8080/lists/${n}/shared`:`https://easylist.link/lists/${n}/shared`,e.status(200).json({msg:a,link:d})}catch(t){throw new Error(t)}},getCopy:async(t,e)=>{try{const{id:n}=t.params,o=await i.findById(n);if(!o)return e.status(401).json({error:"Your request did not return a list."});if(o.isPrivate)return e.status(401).json({error:"This list is private"});const{name:r,html:a,backgroundColor:s}=o;return o.copiedFrom=n,o.isFinished=!1,e.status(200).json({list:o})}catch(t){throw new Error(t)}},editList:async(t,e)=>{const{id:n}=t.params,o=await i.findById(n);e.status(200).json({list:o})},createList:async(t,e)=>{try{const{html:n,name:o,backgroundColor:a,updatedAt:s,notificationsOn:d,isPrivate:l,isFinished:c,copiedFrom:p}=t.body,{user:u}=t,h=await r(n),m=new i({name:o,backgroundColor:a,updatedAt:s,notificationsOn:d,isPrivate:l,html:h,authorId:u,isFinished:c,copiedFrom:p});await m.save((t,n)=>t?`Error occurred while saving ${t}`:e.status(200).json({list:n}))}catch(t){throw new Error(t)}},updateList:async(t,e)=>{try{const{id:n}=t.params,{name:o,html:a,backgroundColor:s,notificationsOn:d,isPrivate:l,updatedAt:c,isFinished:p,copiedFrom:u}=t.body,{user:h}=t,m=await i.findById(n);if(m.authorId.toString()!==h)return e.status(401).json({error:"This list cannot be edited by this user."});const g=r(a);await m.updateOne({name:o,html:g,backgroundColor:s,notificationsOn:d,isPrivate:l,updatedAt:c,isFinished:p,copiedFrom:u}),e.status(200).json({msg:"List updated"})}catch(t){throw new Error(t)}},completeList:async(t,e)=>{try{const{id:n}=t.params,{user:r}=t,s=await i.findById(n);if(s.isFinished)return e.status(401).json({error:"already finished"});const d=await i.findById(s.copiedFrom);if(!d.notificationsOn)return e.status(401).json({error:"notifications off"});const l=await o.findById(d.authorId),c=await o.findById(r);await a(s.name,l.email,l.username,c.username),s.isFinished=!0,await s.save(),e.status(200).json({list:s})}catch(t){throw new Error(t)}},deleteList:async(t,e)=>{try{if(!await i.findByIdAndDelete({_id:t.params.id}))return e.status(404).json({error:"No list found with this id."});e.status(200).json({msg:"List deleted"})}catch(t){throw new Error(t)}}}},function(t,e,n){const i=n(0),o=i.Schema,r=new o({name:{type:String,required:!0},authorId:{type:o.Types.ObjectId,ref:"User"},html:String,backgroundColor:String,isPrivate:{type:Boolean,default:!0},notificationsOn:{type:Boolean,default:!1},updatedAt:{type:Date,default:Date.now()},copiedFrom:String,isFinished:Boolean}),a=i.model("list",r);t.exports=a}]);